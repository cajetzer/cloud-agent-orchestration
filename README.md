# GitHub Agentic Workflows â€” Multi-Agent ADF Pipeline Orchestration

A **learning and demo repository** showing how to use **GitHub Agentic Workflows** (technical preview) for multi-agent orchestration of Azure Data Factory pipeline generation and review.

This demonstrates:
- **Custom Agents** (`.github/agents/`) - Reusable, manually-assignable agents
- **Agentic Workflows** (`.github/workflows/*.md`) - Automated orchestration that invokes those agents
- **Orchestrator/Worker Pattern** - Coordinator dispatches specialized workers

> âš ï¸ **Technical Preview**: GitHub Agentic Workflows launched February 13, 2026. This is cutting-edge functionality that may change.

## What This Repository Demonstrates

| Concept | Files | Purpose |
|---------|-------|---------|
| **Custom Agents** | `.github/agents/adf-generate.agent.md` | Manually assignable pipeline generator |
| | `.github/agents/adf-review.agent.md` | Manually assignable pipeline reviewer |
| **Orchestrator Workflow** | `.github/workflows/adf-orchestrator.md` | Automated coordination |
| **Worker Workflows** | `.github/workflows/adf-generate-worker.md` | Invokes generate agent with tools |
| | `.github/workflows/adf-review-worker.md` | Invokes review agent with KB access |

### Two Ways to Use the Agents

| Method | How | When |
|--------|-----|------|
| **Manual** | Assign Copilot to issue â†’ Select agent from dropdown | Ad-hoc work, testing |
| **Automated** | Label issue â†’ Orchestrator dispatches workers | Production automation |

---

## Architecture: Multi-Agent Orchestration

```
    Rev -->|"safe-output:\nadd-comment, add-labels"| PR

    PR["ðŸ“‹ Pull Request\nâ€¢ Pipeline JSON generated by worker\nâ€¢ Review findings with KB references\nâ€¢ Labels: approved / changes-requested /\napproved-with-warnings"]
```

---

## Custom Agents (Manually Assignable)

The agents in `.github/agents/` can be used **manually** by assigning Copilot to an issue/PR:

### `adf-generate.agent.md`
```yaml
---
name: ADF Pipeline Generator
description: Generates Azure Data Factory pipeline JSON definitions
tools: ["read", "edit", "search"]
---
```

### `adf-review.agent.md`
```yaml
---
name: ADF Pipeline Review Agent
description: Reviews ADF pipelines for best practices and common issues
tools: ["read", "search"]
---
```

**Manual usage:**
1. Open an issue describing pipeline requirements
2. Click **Assignees** â†’ Add **Copilot**
3. Select **ADF Pipeline Generator** from the dropdown
4. Copilot works using the agent's instructions

---

## Agentic Workflows (Automated Orchestration)

The workflows in `.github/workflows/` provide **automated** orchestration:

### 1. Orchestrator (`adf-orchestrator.md`)

**Role**: Coordinator that dispatches work to specialized workers

```yaml
safe-outputs:
  dispatch-workflow:
    workflows: [adf-generate-worker, adf-review-worker]
    max: 5
```

**Responsibilities**:
- Validates issue requirements
- Dispatches generation worker with issue context
- Waits for PR creation
- Dispatches review worker with PR context
- Handles final outcome (approve/request changes)

### 2. Generation Worker (`adf-generate-worker.md`)

**Role**: Invokes the ADF Generate agent with workflow-specific tools

```yaml
safe-outputs:
  assign-to-agent:
    agent: adf-generate  # References .github/agents/adf-generate.agent.md

tools:
  github:
  edit:
  bash: ["jq"]
```

### 3. Review Worker (`adf-review-worker.md`)

**Role**: Invokes the ADF Review agent with knowledge base access

```yaml
safe-outputs:
  assign-to-agent:
    agent: adf-review  # References .github/agents/adf-review.agent.md

tools:
  github:
  bash: ["jq"]
  adf-knowledge-base:  # MCP server - additional tool for this workflow
    type: stdio
    command: "npx"
    args: ["-y", "@adf-tools/knowledge-base-mcp"]
```

**Key insight**: The workflow can provide **additional tools** (like the knowledge base MCP) that the base agent doesn't have when used manually.

---

## Why Multi-Agent vs Single Agent?

| Aspect | Single Agent | Multi-Agent Orchestration |
|--------|--------------|---------------------------|
| **Separation of concerns** | One agent does everything | Specialized agents per task |
| **Tool access** | All tools to one agent | Right tools to right agent |
| **Context management** | Long context, may drift | Fresh context per worker |
| **Failure isolation** | One failure stops all | Workers can retry independently |
| **Extensibility** | Modify one big agent | Add new workers easily |
| **Security** | Broad permissions | Scoped permissions per worker |

### The Review Worker's Knowledge Base

The review worker has access to `adf-knowledge-base` MCP server:

```markdown
## Available Knowledge Base Queries

- `search_issues(pattern)` - Find known issues matching a pattern
- `get_resolution(issue_id)` - Get recommended fix
- `check_antipatterns(pipeline_json)` - Scan for anti-patterns
```

This provides domain expertise that the generation agent doesn't need.

---

## Quick Start

### Prerequisites

- GitHub organization with **Copilot** (or Claude/Codex API access)
- Repository with **GitHub Actions** enabled
- `gh` CLI with agentic workflows extension

### Setup Steps

1. **Fork or clone** this repository

2. **Install the gh-aw extension**:
   ```bash
   gh extension install github/gh-aw
   ```

3. **Compile all workflows** (generates lock files):
   ```bash
   gh aw compile
   ```

4. **Add required secrets** for your coding agent:
   - For Copilot: Uses your GitHub token automatically
   - For Claude: Add `ANTHROPIC_API_KEY` secret
   - For Codex: Add `OPENAI_API_KEY` secret

5. **Commit and push** the workflow files:
   ```bash
   git add .github/workflows/
   git commit -m "Add agentic workflows for ADF pipeline orchestration"
   git push
   ```

6. **Create the `adf-pipeline` label** in your repository

7. **Test it**: Create an issue describing a pipeline, add the `adf-pipeline` label

### Running Manually

```bash
# Trigger the orchestrator manually
gh aw run adf-orchestrator

# Check workflow status
gh aw status
```

---

## Repository Structure

```
â”œâ”€â”€ .github/
â”‚   â”œâ”€â”€ agents/                            # Custom agents (manually assignable)
â”‚   â”‚   â”œâ”€â”€ adf-generate.agent.md          # Pipeline generation agent
â”‚   â”‚   â””â”€â”€ adf-review.agent.md            # Pipeline review agent
â”‚   â””â”€â”€ workflows/                         # Agentic workflows (automated)
â”‚       â”œâ”€â”€ adf-orchestrator.md            # Orchestrator (coordinates workers)
â”‚       â”œâ”€â”€ adf-generate-worker.md         # Invokes generate agent
â”‚       â”œâ”€â”€ adf-review-worker.md           # Invokes review agent + KB
â”‚       â””â”€â”€ *.lock.yml                     # Compiled workflows (generated)
â”œâ”€â”€ templates/                             # ADF pipeline JSON templates
â”‚   â”œâ”€â”€ copy_activity.json
â”‚   â””â”€â”€ dataflow_activity.json
â”œâ”€â”€ rules/
â”‚   â”œâ”€â”€ best_practices.json                # Review rules
â”‚   â””â”€â”€ common_issues.json                 # Knowledge base for review agent
â”œâ”€â”€ examples/
â”‚   â””â”€â”€ sample-issue.md                    # Example issue to try
â”œâ”€â”€ AGENTS.md                              # Repo-wide agent instructions
â””â”€â”€ README.md
```

---

## Key Concepts

### Frontmatter (YAML)
```yaml
on:              # Standard GitHub Actions triggers
permissions:     # Read-only by default (security)
safe-outputs:    # Controlled write operations
tools:           # What the agent can use
```

### Markdown Body
Natural language instructions for the coding agent. Describe:
- **What** you want (outcomes)
- **How** to validate (checks)
- **When** to escalate (error handling)

### Safe Outputs
The agent runs read-only. Write operations happen through **safe outputs**:

| Safe Output | What It Does |
|-------------|--------------|
| `create-pull-request` | Creates a PR with agent's code |
| `add-comment` | Posts comments on issues/PRs |
| `add-labels` | Adds labels to issues/PRs |
| `dispatch-workflow` | **Triggers other workflows (orchestration!)** |

### The dispatch-workflow Safe Output

This is the key to multi-agent orchestration:

```yaml
safe-outputs:
  dispatch-workflow:
    workflows: [adf-generate-worker, adf-review-worker]
    max: 5
```

The orchestrator can trigger worker workflows, passing context via inputs.

---

## Why Agentic Workflows vs Other Approaches?

### Compared to Custom Agents + GraphQL Workflows (main branch)

| Aspect | Custom Agents + Workflows | Agentic Workflows |
|--------|---------------------------|-------------------|
| Trigger mechanism | GraphQL API (undocumented) | Native Actions trigger |
| Write permissions | Requires PAT | Safe outputs (no PAT) |
| Agent orchestration | Manual or unreliable API | `dispatch-workflow` |
| Security model | You manage it | Built-in sandboxing |
| Complexity | 5 YAML + 2 agents | 3 markdown files |

### Compared to Single Agent (feature/single-agent-approach)

| Aspect | Single Agent | Multi-Agent Orchestration |
|--------|--------------|---------------------------|
| Separation | All in one | Specialized workers |
| Tool scoping | All tools everywhere | Right tools per worker |
| Failure handling | Entire agent fails | Individual workers retry |
| Extensibility | Modify one agent | Add new workers |

---

## Comparison: Three Approaches

This repository has three branches demonstrating different approaches:

| Branch | Approach | Agents | Workflows | Automation |
|--------|----------|--------|-----------|------------|
| `main` | Custom Agents + GraphQL | 2 agents | 5 YAML | Partial (API issues) |
| `feature/single-agent-approach` | Single Custom Agent | 1 agent | 0 | Manual trigger |
| `feature/agentic-workflows` | **Agentic Workflows** | 3 workers | 3 markdown | **Full orchestration** |

---

## The Knowledge Base

The review worker has access to `rules/common_issues.json` via MCP:

```json
{
  "issues": {
    "KB-010": {
      "name": "Small File Iteration Anti-Pattern",
      "severity": "warning",
      "description": "Iterating over many small files is inefficient",
      "resolution": "Use wildcard file paths with bulk copy"
    },
    "KB-020": {
      "name": "Plaintext Secret in Pipeline",
      "severity": "error",
      "resolution": "Use Azure Key Vault linked service"
    }
  }
}
```

This gives the review agent domain expertise to catch issues the generation agent might miss.

---

## Further Reading

| Topic | Resource |
|-------|----------|
| **Agentic Workflows Docs** | [github.github.com/gh-aw](https://github.github.com/gh-aw/) |
| **Orchestration Pattern** | [Orchestration](https://github.github.com/gh-aw/patterns/orchestration/) |
| **Safe Outputs Reference** | [Safe Outputs](https://github.github.com/gh-aw/reference/safe-outputs/) |
| **dispatch-workflow** | [Workflow Dispatch](https://github.github.com/gh-aw/reference/safe-outputs/#workflow-dispatch-dispatch-workflow) |

---

## License

MIT License - use this as a starting point for your own agentic workflows.
