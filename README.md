# GitHub Agentic Workflows — Multi-Agent ADF Pipeline Orchestration

A **learning and demo repository** showing how to use **GitHub Agentic Workflows** (technical preview) for multi-agent orchestration of Azure Data Factory pipeline generation and review.

This demonstrates the **orchestrator/worker pattern**: an orchestrator dispatches specialized worker agents, each with their own tools and expertise.

> ⚠️ **Technical Preview**: GitHub Agentic Workflows launched February 13, 2026. This is cutting-edge functionality that may change.

## What This Repository Demonstrates

| Concept | Implementation |
|---------|----------------|
| **Orchestrator** | `adf-orchestrator.md` - Coordinates the workflow |
| **Generation Worker** | `adf-generate-worker.md` - Creates pipelines |
| **Review Worker** | `adf-review-worker.md` - Reviews with knowledge base |
| **Worker Dispatch** | `dispatch-workflow` safe-output |
| **Specialized Tools** | Review agent has MCP knowledge base access |

---

## Architecture: Multi-Agent Orchestration

```
┌─────────────────────────────────────────────────────────────────┐
│                         GitHub Issue                            │
│  "Create a pipeline to copy data from Blob to SQL Database"     │
│  Label: adf-pipeline                                            │
└─────────────────────────────────────────────────────────────────┘
                              │
                              │  Issue labeled triggers orchestrator
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                     ADF ORCHESTRATOR                            │
│                  adf-orchestrator.md                            │
│                                                                 │
│  Tools: [github]                                                │
│                                                                 │
│  1. Validate issue has requirements                             │
│  2. Dispatch generation worker                                  │
│  3. Monitor for PR creation                                     │
│  4. Dispatch review worker                                      │
│  5. Handle review results                                       │
└─────────────────────────────────────────────────────────────────┘
          │                                       │
          │ dispatch-workflow                     │ dispatch-workflow
          ▼                                       ▼
┌─────────────────────────┐         ┌─────────────────────────────┐
│   GENERATION WORKER     │         │      REVIEW WORKER          │
│ adf-generate-worker.md  │         │  adf-review-worker.md       │
│                         │         │                             │
│ Tools:                  │         │ Tools:                      │
│  • github               │         │  • github                   │
│  • edit                 │         │  • adf-knowledge-base (MCP) │
│  • bash [jq]            │         │  • bash [jq]                │
│                         │         │                             │
│ Capabilities:           │         │ Capabilities:               │
│  • Read templates       │         │  • Query common issues DB   │
│  • Generate JSON        │         │  • Check anti-patterns      │
│  • Create PR            │         │  • Get fix resolutions      │
│                         │         │  • Post detailed review     │
└─────────────────────────┘         └─────────────────────────────┘
          │                                       │
          │ safe-output:                          │ safe-output:
          │ create-pull-request                   │ add-comment, add-labels
          ▼                                       ▼
┌─────────────────────────────────────────────────────────────────┐
│                        Pull Request                             │
│  • Pipeline JSON generated by worker                            │
│  • Review findings with knowledge base references               │
│  • Labels: approved / changes-requested / approved-with-warnings│
└─────────────────────────────────────────────────────────────────┘
```

---

## The Three Workflows

### 1. Orchestrator (`adf-orchestrator.md`)

**Role**: Coordinator that dispatches work to specialized workers

```yaml
safe-outputs:
  dispatch-workflow:
    workflows: [adf-generate-worker, adf-review-worker]
    max: 5
```

**Responsibilities**:
- Validates issue requirements
- Dispatches generation worker with issue context
- Waits for PR creation
- Dispatches review worker with PR context
- Handles final outcome (approve/request changes)

### 2. Generation Worker (`adf-generate-worker.md`)

**Role**: Specialized agent for ADF pipeline creation

```yaml
tools:
  github:
  edit:
  bash: ["jq"]
```

**Responsibilities**:
- Reads issue requirements
- Selects appropriate template
- Generates pipeline JSON with proper structure
- Validates before submission
- Creates PR via safe-output

### 3. Review Worker (`adf-review-worker.md`)

**Role**: Specialized agent for pipeline review with knowledge base access

```yaml
tools:
  github:
  bash: ["jq"]
  adf-knowledge-base:              # MCP server for domain knowledge
    type: stdio
    command: "npx"
    args: ["-y", "@adf-tools/knowledge-base-mcp"]
```

**Responsibilities**:
- Reviews pipeline against best practices
- Queries knowledge base for common issues
- Identifies anti-patterns
- Provides resolutions with KB references
- Posts detailed review with fix suggestions

---

## Why Multi-Agent vs Single Agent?

| Aspect | Single Agent | Multi-Agent Orchestration |
|--------|--------------|---------------------------|
| **Separation of concerns** | One agent does everything | Specialized agents per task |
| **Tool access** | All tools to one agent | Right tools to right agent |
| **Context management** | Long context, may drift | Fresh context per worker |
| **Failure isolation** | One failure stops all | Workers can retry independently |
| **Extensibility** | Modify one big agent | Add new workers easily |
| **Security** | Broad permissions | Scoped permissions per worker |

### The Review Worker's Knowledge Base

The review worker has access to `adf-knowledge-base` MCP server:

```markdown
## Available Knowledge Base Queries

- `search_issues(pattern)` - Find known issues matching a pattern
- `get_resolution(issue_id)` - Get recommended fix
- `check_antipatterns(pipeline_json)` - Scan for anti-patterns
```

This provides domain expertise that the generation agent doesn't need.

---

## Quick Start

### Prerequisites

- GitHub organization with **Copilot** (or Claude/Codex API access)
- Repository with **GitHub Actions** enabled
- `gh` CLI with agentic workflows extension

### Setup Steps

1. **Fork or clone** this repository

2. **Install the gh-aw extension**:
   ```bash
   gh extension install github/gh-aw
   ```

3. **Compile all workflows** (generates lock files):
   ```bash
   gh aw compile
   ```

4. **Add required secrets** for your coding agent:
   - For Copilot: Uses your GitHub token automatically
   - For Claude: Add `ANTHROPIC_API_KEY` secret
   - For Codex: Add `OPENAI_API_KEY` secret

5. **Commit and push** the workflow files:
   ```bash
   git add .github/workflows/
   git commit -m "Add agentic workflows for ADF pipeline orchestration"
   git push
   ```

6. **Create the `adf-pipeline` label** in your repository

7. **Test it**: Create an issue describing a pipeline, add the `adf-pipeline` label

### Running Manually

```bash
# Trigger the orchestrator manually
gh aw run adf-orchestrator

# Check workflow status
gh aw status
```

---

## Repository Structure

```
├── .github/
│   └── workflows/
│       ├── adf-orchestrator.md          # Orchestrator (coordinates workers)
│       ├── adf-generate-worker.md       # Generation worker
│       ├── adf-review-worker.md         # Review worker (with KB access)
│       └── *.lock.yml                   # Compiled workflows (generated)
├── templates/                           # ADF pipeline JSON templates
│   ├── copy_activity.json
│   └── dataflow_activity.json
├── rules/
│   ├── best_practices.json              # Review rules
│   └── common_issues.json               # Knowledge base for review agent
├── examples/
│   └── sample-issue.md                  # Example issue to try
├── AGENTS.md                            # Repo-wide agent instructions
└── README.md
```

---

## Key Concepts

### Frontmatter (YAML)
```yaml
on:              # Standard GitHub Actions triggers
permissions:     # Read-only by default (security)
safe-outputs:    # Controlled write operations
tools:           # What the agent can use
```

### Markdown Body
Natural language instructions for the coding agent. Describe:
- **What** you want (outcomes)
- **How** to validate (checks)
- **When** to escalate (error handling)

### Safe Outputs
The agent runs read-only. Write operations happen through **safe outputs**:

| Safe Output | What It Does |
|-------------|--------------|
| `create-pull-request` | Creates a PR with agent's code |
| `add-comment` | Posts comments on issues/PRs |
| `add-labels` | Adds labels to issues/PRs |
| `dispatch-workflow` | **Triggers other workflows (orchestration!)** |

### The dispatch-workflow Safe Output

This is the key to multi-agent orchestration:

```yaml
safe-outputs:
  dispatch-workflow:
    workflows: [adf-generate-worker, adf-review-worker]
    max: 5
```

The orchestrator can trigger worker workflows, passing context via inputs.

---

## Why Agentic Workflows vs Other Approaches?

### Compared to Custom Agents + GraphQL Workflows (main branch)

| Aspect | Custom Agents + Workflows | Agentic Workflows |
|--------|---------------------------|-------------------|
| Trigger mechanism | GraphQL API (undocumented) | Native Actions trigger |
| Write permissions | Requires PAT | Safe outputs (no PAT) |
| Agent orchestration | Manual or unreliable API | `dispatch-workflow` |
| Security model | You manage it | Built-in sandboxing |
| Complexity | 5 YAML + 2 agents | 3 markdown files |

### Compared to Single Agent (feature/single-agent-approach)

| Aspect | Single Agent | Multi-Agent Orchestration |
|--------|--------------|---------------------------|
| Separation | All in one | Specialized workers |
| Tool scoping | All tools everywhere | Right tools per worker |
| Failure handling | Entire agent fails | Individual workers retry |
| Extensibility | Modify one agent | Add new workers |

---

## Comparison: Three Approaches

This repository has three branches demonstrating different approaches:

| Branch | Approach | Agents | Workflows | Automation |
|--------|----------|--------|-----------|------------|
| `main` | Custom Agents + GraphQL | 2 agents | 5 YAML | Partial (API issues) |
| `feature/single-agent-approach` | Single Custom Agent | 1 agent | 0 | Manual trigger |
| `feature/agentic-workflows` | **Agentic Workflows** | 3 workers | 3 markdown | **Full orchestration** |

---

## The Knowledge Base

The review worker has access to `rules/common_issues.json` via MCP:

```json
{
  "issues": {
    "KB-010": {
      "name": "Small File Iteration Anti-Pattern",
      "severity": "warning",
      "description": "Iterating over many small files is inefficient",
      "resolution": "Use wildcard file paths with bulk copy"
    },
    "KB-020": {
      "name": "Plaintext Secret in Pipeline",
      "severity": "error",
      "resolution": "Use Azure Key Vault linked service"
    }
  }
}
```

This gives the review agent domain expertise to catch issues the generation agent might miss.

---

## Further Reading

| Topic | Resource |
|-------|----------|
| **Agentic Workflows Docs** | [github.github.com/gh-aw](https://github.github.com/gh-aw/) |
| **Orchestration Pattern** | [Orchestration](https://github.github.com/gh-aw/patterns/orchestration/) |
| **Safe Outputs Reference** | [Safe Outputs](https://github.github.com/gh-aw/reference/safe-outputs/) |
| **dispatch-workflow** | [Workflow Dispatch](https://github.github.com/gh-aw/reference/safe-outputs/#workflow-dispatch-dispatch-workflow) |

---

## License

MIT License - use this as a starting point for your own agentic workflows.
